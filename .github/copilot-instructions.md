# AI Agent Onboarding

- Architecture: Triangular stack with Next.js frontend, Django REST core (8000), FastAPI AI (8001), and dual Postgres (relational + pgvector) — see [docs1/backend-architecture.md](docs1/backend-architecture.md).
- Service boundaries: Django owns business data; FastAPI never hits the relational DB directly and instead calls Django APIs via the shared JWT context — see the flow in [docs1/backend-architecture.md](docs1/backend-architecture.md).
- Authentication: Both backends verify the same JWT secret; tokens carry `user_id`. Keep `JWT_SECRET_KEY` and `DJANGO_SECRET_KEY` in sync across services.
- Environment precedence: Root `.env` is the primary source; Django/FastAPI fall back to nested `.env` files — outlined in [docs1/env_file_setup.md](docs1/env_file_setup.md).
- Default ports: Django 8000, FastAPI 8001, Next.js 3000, Postgres relational 5434 (host), Postgres vector 5433, Redis 6379 — from [backend/docker-compose.yml](backend/docker-compose.yml).
- Local Django (no Docker): `cd backend/django_app && bash quick_start.sh` to create venv, install deps, seed `.env`, create DB, and migrate; then `bash start_server.sh` to run the dev server with port collision checks — see [backend/django_app/quick_start.sh](backend/django_app/quick_start.sh) and [backend/django_app/start_server.sh](backend/django_app/start_server.sh).
- Fullstack via Docker: `bash start_fullstack.sh` kills conflicting ports, brings up Postgres/Redis/Django/FastAPI with `docker compose -f backend/docker-compose.yml -f backend/compose.override.dev.yml up -d`, then launches Next.js dev server — see [start_fullstack.sh](start_fullstack.sh).
- Compose details: [backend/docker-compose.yml](backend/docker-compose.yml) builds Postgres (relational + vector), Redis, Django, and FastAPI; env vars for DB, JWT, embedding model, and CORS are wired there. Overrides in `backend/compose.override.*.yml` adjust environment-specific settings.
- Health checks: Django `/api/v1/health/`, FastAPI `/health`; Docker healthchecks defined in [backend/docker-compose.yml](backend/docker-compose.yml).
- Frontend gateway: Next.js routes requests to Django vs FastAPI based on path prefixes; tokens are auto-attached and refreshed — see [frontend/nextjs_app/services/apiGateway.ts](frontend/nextjs_app/services/apiGateway.ts).
- Data flow for AI: FastAPI verifies JWT, extracts `user_id`, calls Django endpoints with `Authorization` + `X-User-ID`, processes AI logic, and returns enriched payloads — patterns illustrated in [docs1/backend-architecture.md](docs1/backend-architecture.md).
- DB pattern: Django uses ORM against `ongozacyberhub`; FastAPI uses asyncpg/pgvector against `ongozacyberhub_vector` plus Django APIs for business data — see [docs1/backend-architecture.md](docs1/backend-architecture.md).
- Key AI services: FastAPI routers for profiling, recommendations, embeddings, personality, missions, curriculum, coaching, and dashboard under `backend/fastapi_app/routers/v1/`; services live in `backend/fastapi_app/services/` and vector clients in `backend/fastapi_app/vector_store/`.
- Testing: Django API/AI endpoints use pytest in [backend/django_app/tests](backend/django_app/tests); run `pytest` (or `pytest -m <marker>`). Fixtures and markers are described in [backend/django_app/tests/README.md](backend/django_app/tests/README.md).
- Docs to consult: High-level architecture in [docs1/backend-architecture.md](docs1/backend-architecture.md); AI strategy in [docs/ai_implementation.md](docs/ai_implementation.md); detailed profiler implementation summary in [docs1/ai_implementation_engine.md](docs1/ai_implementation_engine.md).
- Secrets: Do not commit `.env` files; production must override dev defaults (`postgres` passwords and `django-insecure-*` keys) — see [docs1/env_file_setup.md](docs1/env_file_setup.md).
- Contribution pattern: When adding AI endpoints, wire JWT verification via `backend/fastapi_app/utils/auth.py`, fetch business data through the Django API client in `backend/fastapi_app/utils/http_client.py`, and keep responses aligned with existing `/api/v1/*` conventions.
- Frontend expectations: New APIs should follow `/api/v1/<resource>` naming so the API gateway can route without changes; prefer returning pagination-compatible payloads (see Django REST pagination defaults) when listing resources.
- Deployment: Nginx proxy routes `/api/` to Django, `/ai/` to FastAPI, everything else to Next.js — see [docker/nginx/nginx.conf](docker/nginx/nginx.conf).
- Troubleshooting: If local DB auth fails, ensure `DB_PASSWORD` is set in root `.env`; if ports 8000/8001 are busy, stop Docker stack or set `PORT` before running `start_server.sh`.
- All documentations should be clearly defined in `/home/caleb/kiptoo/och/ongozaCyberHub/docs1` with proper structure for easy navigation