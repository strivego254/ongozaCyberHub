# Generated by Django 5.2.9 on 2025-12-06 13:22

import django.contrib.auth.models
import django.contrib.auth.validators
import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
        ('contenttypes', '0002_remove_content_type_name'),
        ('organizations', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='SSOProvider',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
                ('provider_type', models.CharField(choices=[('oidc', 'OpenID Connect'), ('saml', 'SAML 2.0'), ('oauth2', 'OAuth 2.0')], max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('client_id', models.CharField(blank=True, max_length=255, null=True)),
                ('client_secret', models.CharField(blank=True, max_length=255, null=True)),
                ('authorization_endpoint', models.URLField(blank=True, null=True)),
                ('token_endpoint', models.URLField(blank=True, null=True)),
                ('userinfo_endpoint', models.URLField(blank=True, null=True)),
                ('issuer', models.CharField(blank=True, max_length=255, null=True)),
                ('entity_id', models.CharField(blank=True, max_length=255, null=True)),
                ('sso_url', models.URLField(blank=True, null=True)),
                ('x509_cert', models.TextField(blank=True, null=True)),
                ('scopes', models.JSONField(blank=True, default=list)),
                ('attribute_mapping', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'db_table': 'sso_providers',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='User',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('username', models.CharField(error_messages={'unique': 'A user with that username already exists.'}, help_text='Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.', max_length=150, unique=True, validators=[django.contrib.auth.validators.UnicodeUsernameValidator()], verbose_name='username')),
                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),
                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),
                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active. Unselect this instead of deleting accounts.', verbose_name='active')),
                ('date_joined', models.DateTimeField(default=django.utils.timezone.now, verbose_name='date joined')),
                ('email', models.EmailField(db_index=True, max_length=254, unique=True)),
                ('account_status', models.CharField(choices=[('pending_verification', 'Pending Verification'), ('active', 'Active'), ('suspended', 'Suspended'), ('deactivated', 'Deactivated'), ('erased', 'Erased')], default='pending_verification', max_length=20)),
                ('email_verified', models.BooleanField(default=False)),
                ('email_verified_at', models.DateTimeField(blank=True, null=True)),
                ('activated_at', models.DateTimeField(blank=True, null=True)),
                ('deactivated_at', models.DateTimeField(blank=True, null=True)),
                ('erased_at', models.DateTimeField(blank=True, null=True)),
                ('cohort_id', models.CharField(blank=True, db_index=True, max_length=100, null=True)),
                ('track_key', models.CharField(blank=True, db_index=True, max_length=100, null=True)),
                ('country', models.CharField(blank=True, max_length=2, null=True)),
                ('timezone', models.CharField(default='UTC', max_length=50)),
                ('language', models.CharField(default='en', max_length=10)),
                ('risk_level', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], default='low', max_length=20)),
                ('mfa_enabled', models.BooleanField(default=False)),
                ('mfa_method', models.CharField(blank=True, choices=[('totp', 'TOTP'), ('sms', 'SMS'), ('email', 'Email')], max_length=20, null=True)),
                ('password_changed_at', models.DateTimeField(blank=True, null=True)),
                ('last_login_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('bio', models.TextField(blank=True, null=True)),
                ('avatar_url', models.URLField(blank=True, null=True)),
                ('phone_number', models.CharField(blank=True, max_length=20, null=True, validators=[django.core.validators.RegexValidator(message="Phone number must be entered in the format: '+999999999'. Up to 15 digits allowed.", regex='^\\+?1?\\d{9,15}$')])),
                ('preferred_learning_style', models.CharField(blank=True, choices=[('visual', 'Visual'), ('auditory', 'Auditory'), ('kinesthetic', 'Kinesthetic'), ('reading', 'Reading/Writing'), ('mixed', 'Mixed')], help_text='Preferred learning style for TalentScope calculations', max_length=20, null=True)),
                ('career_goals', models.TextField(blank=True, help_text='Career goals and aspirations for TalentScope baseline', null=True)),
                ('profile_complete', models.BooleanField(default=False)),
                ('onboarding_complete', models.BooleanField(default=False)),
                ('is_mentor', models.BooleanField(db_index=True, default=False)),
                ('mentor_capacity_weekly', models.IntegerField(default=10)),
                ('mentor_availability', models.JSONField(blank=True, default=dict)),
                ('mentor_specialties', models.JSONField(blank=True, default=list)),
                ('cyber_exposure_level', models.CharField(blank=True, choices=[('none', 'No Experience'), ('beginner', 'Beginner (Some Awareness)'), ('intermediate', 'Intermediate (Some Training)'), ('advanced', 'Advanced (Professional Experience)')], help_text='Current cyber security exposure level for TalentScope baseline', max_length=20, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to. A user will get all permissions granted to each of their groups.', related_name='user_set', related_query_name='user', to='auth.group', verbose_name='groups')),
                ('org_id', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='user_members', to='organizations.organization')),
                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='user_set', related_query_name='user', to='auth.permission', verbose_name='user permissions')),
            ],
            options={
                'db_table': 'users',
                'ordering': ['-created_at'],
            },
            managers=[
                ('objects', django.contrib.auth.models.UserManager()),
            ],
        ),
        migrations.CreateModel(
            name='APIKey',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=100)),
                ('key_type', models.CharField(choices=[('service', 'Service Key'), ('partner', 'Partner Key'), ('webhook', 'Webhook Key')], max_length=20)),
                ('key_prefix', models.CharField(db_index=True, max_length=20)),
                ('key_hash', models.CharField(db_index=True, max_length=128, unique=True)),
                ('key_value', models.CharField(blank=True, max_length=255, null=True)),
                ('owner_type', models.CharField(choices=[('user', 'User'), ('org', 'Organization'), ('service', 'Service Account')], default='user', max_length=20)),
                ('owner_id', models.UUIDField(blank=True, db_index=True, null=True)),
                ('scopes', models.JSONField(blank=True, default=list)),
                ('allowed_ips', models.JSONField(blank=True, default=list)),
                ('rate_limit_per_min', models.IntegerField(default=60)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('last_used_at', models.DateTimeField(blank=True, null=True)),
                ('revoked_at', models.DateTimeField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('description', models.TextField(blank=True)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='api_keys', to='organizations.organization')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='api_keys', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'api_keys',
            },
        ),
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('actor_type', models.CharField(max_length=20)),
                ('actor_identifier', models.CharField(max_length=255)),
                ('action', models.CharField(choices=[('create', 'Create'), ('read', 'Read'), ('update', 'Update'), ('delete', 'Delete'), ('login', 'Login'), ('logout', 'Logout'), ('mfa_challenge', 'MFA Challenge'), ('mfa_success', 'MFA Success'), ('mfa_failure', 'MFA Failure'), ('password_change', 'Password Change'), ('role_assigned', 'Role Assigned'), ('role_revoked', 'Role Revoked'), ('permission_granted', 'Permission Granted'), ('permission_revoked', 'Permission Revoked'), ('consent_granted', 'Consent Granted'), ('consent_revoked', 'Consent Revoked'), ('api_key_created', 'API Key Created'), ('api_key_revoked', 'API Key Revoked'), ('data_exported', 'Data Exported'), ('data_erased', 'Data Erased'), ('sso_login', 'SSO Login'), ('session_created', 'Session Created'), ('session_revoked', 'Session Revoked'), ('device_trusted', 'Device Trusted'), ('device_revoked', 'Device Revoked')], max_length=50)),
                ('resource_type', models.CharField(max_length=100)),
                ('resource_id', models.CharField(blank=True, max_length=100, null=True)),
                ('object_id', models.PositiveIntegerField(blank=True, null=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True, null=True)),
                ('request_id', models.CharField(blank=True, db_index=True, max_length=100, null=True)),
                ('changes', models.JSONField(blank=True, default=dict)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('result', models.CharField(choices=[('success', 'Success'), ('failure', 'Failure'), ('partial', 'Partial')], default='success', max_length=20)),
                ('error_message', models.TextField(blank=True, null=True)),
                ('timestamp', models.DateTimeField(db_index=True, default=django.utils.timezone.now)),
                ('api_key', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='audit_logs', to='users.apikey')),
                ('content_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='contenttypes.contenttype')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='audit_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'audit_logs',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='ConsentScope',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('scope_type', models.CharField(choices=[('share_with_mentor', 'Share with Mentor'), ('share_with_sponsor', 'Share with Sponsor'), ('analytics', 'Analytics'), ('marketing', 'Marketing'), ('research', 'Research'), ('public_portfolio', 'Public Portfolio'), ('employer_share', 'Employer Share')], max_length=50)),
                ('granted', models.BooleanField(default=False)),
                ('granted_at', models.DateTimeField(blank=True, null=True)),
                ('revoked_at', models.DateTimeField(blank=True, null=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='consent_scopes', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'consent_scopes',
            },
        ),
        migrations.CreateModel(
            name='DataErasure',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('erasure_type', models.CharField(max_length=50)),
                ('data_categories', models.JSONField(blank=True, default=list)),
                ('reason', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('records_erased', models.IntegerField(default=0)),
                ('records_anonymized', models.IntegerField(default=0)),
                ('errors', models.JSONField(blank=True, default=list)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('requested_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='erasures_requested', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='data_erasures', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'data_erasures',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DataExport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('export_type', models.CharField(max_length=50)),
                ('data_categories', models.JSONField(blank=True, default=list)),
                ('format', models.CharField(default='json', max_length=20)),
                ('file_path', models.CharField(blank=True, max_length=500, null=True)),
                ('file_size', models.BigIntegerField(blank=True, null=True)),
                ('file_hash', models.CharField(blank=True, max_length=64, null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed'), ('expired', 'Expired')], default='pending', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('downloaded_at', models.DateTimeField(blank=True, null=True)),
                ('download_count', models.IntegerField(default=0)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('requested_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='exports_requested', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='data_exports', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'data_exports',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DeviceTrust',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('device_id', models.UUIDField(db_index=True, default=uuid.uuid4, unique=True)),
                ('device_name', models.CharField(max_length=255)),
                ('device_type', models.CharField(max_length=50)),
                ('device_fingerprint', models.CharField(db_index=True, max_length=255)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True, null=True)),
                ('trusted_at', models.DateTimeField(auto_now_add=True)),
                ('last_used_at', models.DateTimeField(auto_now=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('revoked_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trusted_devices', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'device_trust',
            },
        ),
        migrations.CreateModel(
            name='Entitlement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('feature', models.CharField(db_index=True, max_length=100)),
                ('granted', models.BooleanField(default=True)),
                ('granted_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='entitlements', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'entitlements',
            },
        ),
        migrations.CreateModel(
            name='MFACode',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(db_index=True, max_length=10)),
                ('method', models.CharField(max_length=20)),
                ('expires_at', models.DateTimeField(db_index=True)),
                ('used', models.BooleanField(default=False)),
                ('used_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='mfa_codes', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'mfa_codes',
            },
        ),
        migrations.CreateModel(
            name='MFAMethod',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('method_type', models.CharField(choices=[('totp', 'TOTP (Time-based One-Time Password)'), ('sms', 'SMS'), ('email', 'Email'), ('backup_codes', 'Backup Codes')], max_length=20)),
                ('secret_encrypted', models.TextField(blank=True, null=True)),
                ('totp_backup_codes', models.JSONField(blank=True, default=list)),
                ('phone_e164', models.CharField(blank=True, max_length=20, null=True)),
                ('enabled', models.BooleanField(default=False)),
                ('is_primary', models.BooleanField(default=False)),
                ('is_verified', models.BooleanField(default=False)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('last_used_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='mfa_methods', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'mfa_methods',
            },
        ),
        migrations.CreateModel(
            name='Permission',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
                ('resource_type', models.CharField(choices=[('user', 'User'), ('organization', 'Organization'), ('cohort', 'Cohort'), ('track', 'Track'), ('portfolio', 'Portfolio'), ('profiling', 'Profiling'), ('mentorship', 'Mentorship'), ('analytics', 'Analytics'), ('billing', 'Billing'), ('invoice', 'Invoice'), ('api_key', 'API Key'), ('webhook', 'Webhook')], max_length=50)),
                ('action', models.CharField(choices=[('create', 'Create'), ('read', 'Read'), ('update', 'Update'), ('delete', 'Delete'), ('list', 'List'), ('manage', 'Manage')], max_length=20)),
                ('description', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'db_table': 'permissions',
                'ordering': ['resource_type', 'action'],
                'unique_together': {('resource_type', 'action')},
            },
        ),
        migrations.CreateModel(
            name='Policy',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255, unique=True)),
                ('description', models.TextField(blank=True)),
                ('effect', models.CharField(choices=[('allow', 'Allow'), ('deny', 'Deny')], max_length=10)),
                ('resource', models.CharField(max_length=100)),
                ('actions', models.JSONField(default=list)),
                ('condition', models.JSONField(blank=True, default=dict)),
                ('version', models.IntegerField(default=1)),
                ('active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'db_table': 'policies',
                'ordering': ['name', '-version'],
                'indexes': [models.Index(fields=['resource', 'active'], name='policies_resourc_65ee67_idx'), models.Index(fields=['effect', 'active'], name='policies_effect_b34a1a_idx')],
            },
        ),
        migrations.CreateModel(
            name='Role',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(choices=[('admin', 'Admin'), ('program_director', 'Program Director'), ('mentor', 'Mentor'), ('mentee', 'Mentee'), ('student', 'Student'), ('finance', 'Finance'), ('sponsor_admin', 'Sponsor/Employer Admin'), ('analyst', 'Analyst')], max_length=50, unique=True)),
                ('display_name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('is_system_role', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('permissions', models.ManyToManyField(blank=True, related_name='roles', to='users.permission')),
            ],
            options={
                'db_table': 'roles',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='SSOConnection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('external_id', models.CharField(db_index=True, max_length=255)),
                ('external_email', models.EmailField(blank=True, max_length=254, null=True)),
                ('access_token', models.TextField(blank=True, null=True)),
                ('refresh_token', models.TextField(blank=True, null=True)),
                ('token_expires_at', models.DateTimeField(blank=True, null=True)),
                ('linked_at', models.DateTimeField(auto_now_add=True)),
                ('last_sync_at', models.DateTimeField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sso_connections', to=settings.AUTH_USER_MODEL)),
                ('provider', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='connections', to='users.ssoprovider')),
            ],
            options={
                'db_table': 'sso_connections',
            },
        ),
        migrations.CreateModel(
            name='UserIdentity',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('provider', models.CharField(choices=[('google', 'Google'), ('microsoft', 'Microsoft'), ('saml', 'SAML 2.0'), ('apple', 'Apple'), ('local', 'Local')], max_length=20)),
                ('provider_sub', models.CharField(db_index=True, max_length=255)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('linked_at', models.DateTimeField(auto_now_add=True)),
                ('last_sync_at', models.DateTimeField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='identities', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'user_identities',
            },
        ),
        migrations.CreateModel(
            name='UserRole',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('scope', models.CharField(choices=[('global', 'Global'), ('org', 'Organization'), ('cohort', 'Cohort'), ('track', 'Track')], default='global', max_length=20)),
                ('scope_ref', models.UUIDField(blank=True, db_index=True, null=True)),
                ('cohort_id', models.CharField(blank=True, max_length=100, null=True)),
                ('track_key', models.CharField(blank=True, max_length=100, null=True)),
                ('assigned_at', models.DateTimeField(auto_now_add=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('assigned_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='role_assignments_made', to=settings.AUTH_USER_MODEL)),
                ('org_id', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='role_assignments', to='organizations.organization')),
                ('role', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_roles', to='users.role')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='user_roles', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'user_roles',
            },
        ),
        migrations.CreateModel(
            name='UserSession',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('device_fingerprint', models.CharField(db_index=True, max_length=255)),
                ('device_name', models.CharField(blank=True, max_length=255, null=True)),
                ('device_type', models.CharField(blank=True, max_length=50, null=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('ua', models.TextField(blank=True, null=True)),
                ('refresh_token_hash', models.CharField(db_index=True, max_length=64, unique=True)),
                ('is_trusted', models.BooleanField(default=False)),
                ('trusted_at', models.DateTimeField(blank=True, null=True)),
                ('mfa_verified', models.BooleanField(default=False)),
                ('risk_score', models.FloatField(default=0.0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('last_activity', models.DateTimeField(auto_now=True)),
                ('expires_at', models.DateTimeField(db_index=True)),
                ('revoked_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sessions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'user_sessions',
            },
        ),
        migrations.CreateModel(
            name='WebhookEndpoint',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('url', models.URLField()),
                ('events', models.JSONField(blank=True, default=list)),
                ('signing_secret', models.CharField(db_index=True, max_length=64)),
                ('signing_secret_hash', models.CharField(max_length=64)),
                ('is_active', models.BooleanField(default=True)),
                ('verify_ssl', models.BooleanField(default=True)),
                ('timeout', models.IntegerField(default=30)),
                ('max_retries', models.IntegerField(default=3)),
                ('retry_backoff', models.FloatField(default=1.5)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_triggered_at', models.DateTimeField(blank=True, null=True)),
                ('organization', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='webhook_endpoints', to='organizations.organization')),
            ],
            options={
                'db_table': 'webhook_endpoints',
            },
        ),
        migrations.CreateModel(
            name='WebhookDelivery',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('event_type', models.CharField(max_length=100)),
                ('payload', models.JSONField()),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('delivered', 'Delivered'), ('failed', 'Failed'), ('retrying', 'Retrying')], default='pending', max_length=20)),
                ('response_status', models.IntegerField(blank=True, null=True)),
                ('response_body', models.TextField(blank=True, null=True)),
                ('response_headers', models.JSONField(blank=True, default=dict)),
                ('attempt_count', models.IntegerField(default=0)),
                ('max_attempts', models.IntegerField(default=3)),
                ('next_retry_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('delivered_at', models.DateTimeField(blank=True, null=True)),
                ('failed_at', models.DateTimeField(blank=True, null=True)),
                ('endpoint', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='deliveries', to='users.webhookendpoint')),
            ],
            options={
                'db_table': 'webhook_deliveries',
            },
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['email'], name='users_email_4b85f2_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['cohort_id'], name='users_cohort__4b091b_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['track_key'], name='users_track_k_9afc75_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['org_id'], name='users_org_id__0a14f1_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['account_status'], name='users_account_33da0c_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['email_verified'], name='users_email_v_0e5f70_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['mfa_enabled'], name='users_mfa_ena_930b3f_idx'),
        ),
        migrations.AddIndex(
            model_name='apikey',
            index=models.Index(fields=['key_prefix'], name='api_keys_key_pre_9c2634_idx'),
        ),
        migrations.AddIndex(
            model_name='apikey',
            index=models.Index(fields=['user', 'is_active'], name='api_keys_user_id_6e7352_idx'),
        ),
        migrations.AddIndex(
            model_name='apikey',
            index=models.Index(fields=['organization', 'is_active'], name='api_keys_organiz_70e45b_idx'),
        ),
        migrations.AddIndex(
            model_name='apikey',
            index=models.Index(fields=['expires_at'], name='api_keys_expires_f68b1a_idx'),
        ),
        migrations.AddIndex(
            model_name='auditlog',
            index=models.Index(fields=['user', 'timestamp'], name='audit_logs_user_id_88267f_idx'),
        ),
        migrations.AddIndex(
            model_name='auditlog',
            index=models.Index(fields=['action', 'timestamp'], name='audit_logs_action_474804_idx'),
        ),
        migrations.AddIndex(
            model_name='auditlog',
            index=models.Index(fields=['resource_type', 'resource_id'], name='audit_logs_resourc_bda8a6_idx'),
        ),
        migrations.AddIndex(
            model_name='auditlog',
            index=models.Index(fields=['timestamp'], name='audit_logs_timesta_423be6_idx'),
        ),
        migrations.AddIndex(
            model_name='auditlog',
            index=models.Index(fields=['request_id'], name='audit_logs_request_298ea7_idx'),
        ),
        migrations.AddIndex(
            model_name='consentscope',
            index=models.Index(fields=['user', 'granted'], name='consent_sco_user_id_558b56_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='consentscope',
            unique_together={('user', 'scope_type')},
        ),
        migrations.AddIndex(
            model_name='dataerasure',
            index=models.Index(fields=['user', 'status'], name='data_erasur_user_id_20e938_idx'),
        ),
        migrations.AddIndex(
            model_name='dataerasure',
            index=models.Index(fields=['created_at'], name='data_erasur_created_34a896_idx'),
        ),
        migrations.AddIndex(
            model_name='dataexport',
            index=models.Index(fields=['user', 'status'], name='data_export_user_id_1e5b27_idx'),
        ),
        migrations.AddIndex(
            model_name='dataexport',
            index=models.Index(fields=['expires_at'], name='data_export_expires_8612f9_idx'),
        ),
        migrations.AddIndex(
            model_name='devicetrust',
            index=models.Index(fields=['user', 'trusted_at'], name='device_trus_user_id_a69c8a_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='devicetrust',
            unique_together={('user', 'device_fingerprint')},
        ),
        migrations.AddIndex(
            model_name='entitlement',
            index=models.Index(fields=['user', 'granted'], name='entitlement_user_id_cf518c_idx'),
        ),
        migrations.AddIndex(
            model_name='entitlement',
            index=models.Index(fields=['feature'], name='entitlement_feature_0a7486_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='entitlement',
            unique_together={('user', 'feature')},
        ),
        migrations.AddIndex(
            model_name='mfacode',
            index=models.Index(fields=['user', 'code', 'used'], name='mfa_codes_user_id_02928a_idx'),
        ),
        migrations.AddIndex(
            model_name='mfacode',
            index=models.Index(fields=['expires_at'], name='mfa_codes_expires_2a908b_idx'),
        ),
        migrations.AddIndex(
            model_name='mfamethod',
            index=models.Index(fields=['user', 'is_primary'], name='mfa_methods_user_id_107e63_idx'),
        ),
        migrations.AddIndex(
            model_name='mfamethod',
            index=models.Index(fields=['user', 'method_type'], name='mfa_methods_user_id_741b75_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='mfamethod',
            unique_together={('user', 'method_type')},
        ),
        migrations.AddIndex(
            model_name='ssoconnection',
            index=models.Index(fields=['user', 'is_active'], name='sso_connect_user_id_01fe0f_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='ssoconnection',
            unique_together={('provider', 'external_id')},
        ),
        migrations.AddIndex(
            model_name='useridentity',
            index=models.Index(fields=['user', 'provider'], name='user_identi_user_id_824f1a_idx'),
        ),
        migrations.AddIndex(
            model_name='useridentity',
            index=models.Index(fields=['provider', 'provider_sub'], name='user_identi_provide_09b4c3_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='useridentity',
            unique_together={('provider', 'provider_sub')},
        ),
        migrations.AddIndex(
            model_name='userrole',
            index=models.Index(fields=['user', 'is_active'], name='user_roles_user_id_4ec42c_idx'),
        ),
        migrations.AddIndex(
            model_name='userrole',
            index=models.Index(fields=['scope', 'scope_ref'], name='user_roles_scope_68a1ac_idx'),
        ),
        migrations.AddIndex(
            model_name='userrole',
            index=models.Index(fields=['cohort_id'], name='user_roles_cohort__16e19d_idx'),
        ),
        migrations.AddIndex(
            model_name='userrole',
            index=models.Index(fields=['track_key'], name='user_roles_track_k_68943c_idx'),
        ),
        migrations.AddIndex(
            model_name='userrole',
            index=models.Index(fields=['org_id'], name='user_roles_org_id__134f15_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='userrole',
            unique_together={('user', 'role', 'cohort_id', 'track_key', 'org_id'), ('user', 'role', 'scope', 'scope_ref')},
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['user', 'is_trusted'], name='user_sessio_user_id_e66ad8_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['expires_at'], name='user_sessio_expires_66ae96_idx'),
        ),
        migrations.AddIndex(
            model_name='usersession',
            index=models.Index(fields=['device_fingerprint'], name='user_sessio_device__4dc2be_idx'),
        ),
        migrations.AddIndex(
            model_name='webhookendpoint',
            index=models.Index(fields=['organization', 'is_active'], name='webhook_end_organiz_f3cdf6_idx'),
        ),
        migrations.AddIndex(
            model_name='webhookdelivery',
            index=models.Index(fields=['endpoint', 'status'], name='webhook_del_endpoin_4ffb63_idx'),
        ),
        migrations.AddIndex(
            model_name='webhookdelivery',
            index=models.Index(fields=['next_retry_at'], name='webhook_del_next_re_b2acb4_idx'),
        ),
        migrations.AddIndex(
            model_name='webhookdelivery',
            index=models.Index(fields=['created_at'], name='webhook_del_created_50111d_idx'),
        ),
    ]
